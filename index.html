<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–µ –ò–≥—Ä—ã ‚Äî –†–∞–∑–¥–∞—á–∏ –∏–≥—Ä</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Unbounded:wght@400;700;900&family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Nunito',sans-serif;background:#0d0f1a;min-height:100vh;padding:30px 16px 60px;color:#e2e8f0;transition:background 0.4s,color 0.4s}
body.light{background:#f1f5f9;color:#1e293b}
.container{max-width:1320px;margin:0 auto}
.header{text-align:center;margin-bottom:36px}
.title{font-family:'Unbounded',sans-serif;font-size:clamp(28px,5vw,52px);font-weight:900;background:linear-gradient(135deg,#60a5fa,#a78bfa,#f472b6);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;margin-bottom:8px}
.subtitle{font-size:15px;color:#94a3b8;margin-bottom:14px}
body.light .subtitle{color:#64748b}
.meta-row{display:flex;gap:8px;justify-content:center;align-items:center;flex-wrap:wrap}
.update-badge{display:inline-flex;align-items:center;gap:6px;padding:6px 16px;background:rgba(255,255,255,0.06);border-radius:50px;color:#94a3b8;font-size:13px;border:1px solid rgba(255,255,255,0.08)}
body.light .update-badge{background:rgba(0,0,0,0.04);border-color:rgba(0,0,0,0.08);color:#64748b}
.live-badge{padding:4px 12px;border-radius:8px;background:rgba(34,197,94,0.15);color:#4ade80;border:1px solid rgba(34,197,94,0.2);font-size:12px;font-weight:700}
.cache-badge{padding:4px 12px;border-radius:8px;background:rgba(251,191,36,0.12);color:#fbbf24;border:1px solid rgba(251,191,36,0.2);font-size:12px;font-weight:700}
.fallback-badge{padding:4px 12px;border-radius:8px;background:rgba(139,92,246,0.15);color:#a78bfa;border:1px solid rgba(139,92,246,0.2);font-size:12px;font-weight:700}
.loading-badge{padding:4px 12px;border-radius:8px;background:rgba(59,130,246,0.15);color:#60a5fa;border:1px solid rgba(59,130,246,0.2);font-size:12px;font-weight:700;animation:pulse 1.5s infinite}
.controls{background:rgba(255,255,255,0.04);padding:20px;border-radius:16px;margin-bottom:18px;border:1px solid rgba(255,255,255,0.06)}
body.light .controls{background:rgba(0,0,0,0.02);border-color:rgba(0,0,0,0.08)}
.search-box{width:100%;padding:13px 18px;border:1px solid rgba(255,255,255,0.1);border-radius:10px;font-size:15px;background:rgba(255,255,255,0.05);color:#e2e8f0;font-family:inherit;margin-bottom:14px;outline:none;transition:border-color 0.2s}
body.light .search-box{background:#fff;border-color:#d1d5db;color:#1e293b}
.search-box:focus{border-color:rgba(139,92,246,0.5)}
.search-box::placeholder{color:#64748b}
.filters{display:flex;gap:8px;flex-wrap:wrap;justify-content:center}
.fbtn{padding:7px 16px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:8px;color:#94a3b8;cursor:pointer;font-weight:700;font-size:13px;font-family:inherit;transition:all 0.2s}
body.light .fbtn{background:rgba(0,0,0,0.04);border-color:rgba(0,0,0,0.1);color:#64748b}
.fbtn.on{background:linear-gradient(135deg,#6366f1,#8b5cf6);border-color:transparent;color:#fff}
.fbtn:hover:not(.on){background:rgba(255,255,255,0.08)}
.sort-row{display:flex;gap:8px;justify-content:center;margin-top:12px;flex-wrap:wrap}
.sort-btn{padding:5px 14px;background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.08);border-radius:6px;color:#64748b;cursor:pointer;font-weight:700;font-size:12px;font-family:inherit;transition:all 0.2s}
body.light .sort-btn{background:rgba(0,0,0,0.03);border-color:rgba(0,0,0,0.08)}
.sort-btn.on{color:#a78bfa;border-color:rgba(167,139,250,0.4)}
.tabs{display:flex;gap:8px;margin-bottom:28px;justify-content:center;flex-wrap:wrap}
.tab{padding:10px 22px;font-weight:800;font-size:14px;border-radius:10px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);color:#94a3b8;cursor:pointer;font-family:inherit;transition:all 0.2s}
body.light .tab{background:rgba(0,0,0,0.04);border-color:rgba(0,0,0,0.1);color:#64748b}
.tab.on{background:linear-gradient(135deg,#6366f1,#8b5cf6);border-color:transparent;color:#fff}
.tiny-row{display:flex;gap:10px;justify-content:center;flex-wrap:wrap;margin:-10px 0 18px}
.chk{display:inline-flex;gap:8px;align-items:center;color:#94a3b8;font-size:13px;background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.06);padding:8px 12px;border-radius:10px;cursor:pointer}
body.light .chk{background:rgba(0,0,0,0.02);border-color:rgba(0,0,0,0.06);color:#64748b}
.chk input{accent-color:#8b5cf6}
.stats{display:flex;justify-content:center;gap:12px;margin-bottom:32px;flex-wrap:wrap}
.stat-card{background:rgba(255,255,255,0.04);padding:16px 22px;border-radius:14px;text-align:center;border:1px solid rgba(255,255,255,0.06);min-width:90px}
body.light .stat-card{background:#fff;border-color:#e2e8f0;box-shadow:0 2px 8px rgba(0,0,0,0.06)}
.stat-card.value-card{border-color:rgba(34,197,94,0.12);background:rgba(34,197,94,0.04)}
.stat-card.savings-card{border-color:rgba(59,130,246,0.12);background:rgba(59,130,246,0.04)}
.stat-number{font-family:'Unbounded',sans-serif;font-size:26px;font-weight:900}
.stat-number.green{color:#4ade80}
.stat-number.blue{color:#60a5fa}
.stat-label{font-size:11px;color:#64748b;margin-top:4px;text-transform:uppercase;letter-spacing:0.06em;font-weight:700}
.stat-label.green{color:#16a34a}
.stat-label.blue{color:#3b82f6}
.games-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:20px;margin-bottom:40px}
.gc{background:#181b2e;border-radius:16px;overflow:hidden;transition:transform 0.25s,box-shadow 0.25s,opacity 0.3s;border:1px solid rgba(255,255,255,0.06);position:relative;animation:fadeUp 0.5s ease-out backwards}
body.light .gc{background:#fff;border-color:#e2e8f0;box-shadow:0 2px 12px rgba(0,0,0,0.06)}
.gc:hover{transform:translateY(-6px);box-shadow:0 16px 48px rgba(99,102,241,0.15)}
.gc.expired-card{opacity:0.5;filter:grayscale(0.5)}
.gc.ending-soon{border-color:rgba(239,68,68,0.3);box-shadow:0 0 20px rgba(239,68,68,0.1)}
.gc.unverified-link{border-color:rgba(251,191,36,0.2)}
.take-btn{position:absolute;top:10px;right:10px;width:38px;height:38px;border-radius:50%;border:1px solid rgba(255,255,255,0.10);background:rgba(0,0,0,0.55);backdrop-filter:blur(6px);-webkit-backdrop-filter:blur(6px);cursor:pointer;z-index:5;display:flex;align-items:center;justify-content:center;color:#94a3b8;font-weight:900;font-size:16px;transition:all 0.25s}
.take-btn:hover{transform:scale(1.12)}
.take-btn.on{background:rgba(34,197,94,0.22);border-color:rgba(34,197,94,0.35);color:#4ade80}
.take-btn.pop{animation:popIn 0.4s ease}
.gi{width:100%;height:180px;object-fit:cover;display:block;background:linear-gradient(135deg,#1e1b4b,#312e81)}
.gi-ph{width:100%;height:180px;display:flex;flex-direction:column;align-items:center;justify-content:center;font-size:14px;font-weight:800;color:rgba(255,255,255,0.6);text-align:center;padding:16px;gap:8px}
.gi-ph::before{content:'üéÆ';font-size:36px;opacity:0.5}
.gc-body{padding:20px}
.gc-head{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:10px;gap:12px}
.gc-title{font-family:'Unbounded',sans-serif;font-size:15px;font-weight:700;color:#f1f5f9;line-height:1.3;flex:1}
body.light .gc-title{color:#1e293b}
.gc-badges{display:flex;flex-direction:column;gap:5px;align-items:flex-end;flex-shrink:0}
.badge{padding:3px 9px;border-radius:5px;font-size:10px;font-weight:800;text-transform:uppercase;white-space:nowrap}
.b-epic{background:rgba(59,130,246,0.15);color:#60a5fa;border:1px solid rgba(59,130,246,0.25)}
.b-steam{background:rgba(99,102,241,0.12);color:#a5b4fc;border:1px solid rgba(99,102,241,0.2)}
.b-gog{background:rgba(168,85,247,0.12);color:#c084fc;border:1px solid rgba(168,85,247,0.2)}
.b-itchio{background:rgba(245,101,101,0.12);color:#fca5a5;border:1px solid rgba(245,101,101,0.2)}
.b-other{background:rgba(148,163,184,0.12);color:#94a3b8;border:1px solid rgba(148,163,184,0.2)}
.b-hot{background:rgba(239,68,68,0.15);color:#fca5a5;border:1px solid rgba(239,68,68,0.25)}
.b-val{background:rgba(34,197,94,0.10);color:#4ade80;border:1px solid rgba(34,197,94,0.18);font-size:9px}
.b-taken{background:rgba(34,197,94,0.16);color:#4ade80;border:1px solid rgba(34,197,94,0.26)}
.b-new{background:rgba(251,191,36,0.15);color:#fbbf24;border:1px solid rgba(251,191,36,0.25);animation:pulse 2s infinite}
.b-expired{background:rgba(239,68,68,0.12);color:#f87171;border:1px solid rgba(239,68,68,0.2)}
.b-verified{background:rgba(34,197,94,0.12);color:#4ade80;border:1px solid rgba(34,197,94,0.2)}
.b-ending{background:rgba(251,146,60,0.15);color:#fb923c;border:1px solid rgba(251,146,60,0.25);animation:pulse 1.5s infinite}
.b-unverified{background:rgba(251,191,36,0.12);color:#fbbf24;border:1px solid rgba(251,191,36,0.2)}
.b-dead{background:rgba(239,68,68,0.15);color:#f87171;border:1px solid rgba(239,68,68,0.25)}
.gc-desc{color:#64748b;font-size:13px;line-height:1.5;margin-bottom:16px;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}
.cd{background:rgba(239,68,68,0.08);padding:8px 12px;border-radius:8px;margin-bottom:14px;text-align:center;border:1px solid rgba(239,68,68,0.12)}
.cd-t{font-size:11px;color:#f87171;font-weight:700}
.cd-v{font-size:15px;font-weight:900;color:#f87171;margin-top:3px;font-family:'Unbounded',sans-serif}
.cd-ending{background:rgba(251,146,60,0.12);border-color:rgba(251,146,60,0.2)}
.cd-ending .cd-t,.cd-ending .cd-v{color:#fb923c}
.cd-expired{background:rgba(239,68,68,0.15);border-color:rgba(239,68,68,0.25)}
.cd-expired .cd-t,.cd-expired .cd-v{color:#ef4444}
.link-warning{background:rgba(251,191,36,0.08);border:1px solid rgba(251,191,36,0.15);border-radius:8px;padding:6px 10px;margin-bottom:14px;text-align:center;font-size:11px;color:#fbbf24;font-weight:700}
.link-dead{background:rgba(239,68,68,0.1);border:1px solid rgba(239,68,68,0.2);border-radius:8px;padding:6px 10px;margin-bottom:14px;text-align:center;font-size:11px;color:#f87171;font-weight:700}
.gc-foot{display:flex;justify-content:space-between;align-items:center;padding-top:16px;border-top:1px solid rgba(255,255,255,0.06);gap:12px}
body.light .gc-foot{border-top-color:rgba(0,0,0,0.06)}
.p-free{font-family:'Unbounded',sans-serif;font-size:18px;font-weight:900;background:linear-gradient(135deg,#4ade80,#22d3ee);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
.gc-link{padding:9px 20px;background:linear-gradient(135deg,#6366f1,#8b5cf6);color:#fff;text-decoration:none;border-radius:10px;font-weight:800;font-size:13px;transition:all 0.2s;white-space:nowrap;display:inline-flex;align-items:center;gap:6px}
.gc-link:hover{transform:scale(1.04);box-shadow:0 8px 24px rgba(99,102,241,0.35)}
.gc-link.disabled{opacity:0.5;pointer-events:none;background:#475569}
.gc-link.warn-link{background:linear-gradient(135deg,#d97706,#f59e0b)}
.empty{text-align:center;padding:40px 20px;color:#64748b;font-size:15px}
.src{text-align:center;padding:20px;color:#475569;font-size:12px}
.src a{color:#6366f1;text-decoration:none}
.skeleton-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:20px;margin-bottom:40px}
.skeleton-card{background:#181b2e;border-radius:16px;overflow:hidden;border:1px solid rgba(255,255,255,0.06)}
body.light .skeleton-card{background:#fff;border-color:#e2e8f0}
.skeleton-img{width:100%;height:180px;background:linear-gradient(90deg,#1e1b4b 25%,#2d2a5e 50%,#1e1b4b 75%);background-size:200% 100%;animation:shimmer 1.5s infinite}
body.light .skeleton-img{background:linear-gradient(90deg,#e2e8f0 25%,#f1f5f9 50%,#e2e8f0 75%);background-size:200% 100%}
.skeleton-body{padding:20px}
.skeleton-line{height:14px;border-radius:7px;background:linear-gradient(90deg,rgba(255,255,255,0.05) 25%,rgba(255,255,255,0.1) 50%,rgba(255,255,255,0.05) 75%);background-size:200% 100%;animation:shimmer 1.5s infinite;margin-bottom:10px}
body.light .skeleton-line{background:linear-gradient(90deg,#e2e8f0 25%,#f1f5f9 50%,#e2e8f0 75%);background-size:200% 100%}
.skeleton-line.w60{width:60%}.skeleton-line.w80{width:80%}.skeleton-line.w40{width:40%}
.toolbar{display:flex;gap:8px;justify-content:center;flex-wrap:wrap;margin-bottom:20px}
.tool-btn{padding:7px 16px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:8px;color:#94a3b8;cursor:pointer;font-weight:700;font-size:12px;font-family:inherit;transition:all 0.2s;display:inline-flex;align-items:center;gap:6px}
body.light .tool-btn{background:rgba(0,0,0,0.04);border-color:rgba(0,0,0,0.1);color:#64748b}
.tool-btn:hover{background:rgba(255,255,255,0.08);color:#e2e8f0}
.tool-btn.refreshing{opacity:0.6;pointer-events:none}
.tool-btn .spin{display:inline-block;animation:spinAnim 1s linear infinite}
.toast{position:fixed;bottom:30px;left:50%;transform:translateX(-50%) translateY(100px);background:#1e293b;color:#e2e8f0;padding:12px 24px;border-radius:12px;font-size:14px;font-weight:700;border:1px solid rgba(255,255,255,0.1);z-index:1000;transition:transform 0.3s ease;box-shadow:0 8px 32px rgba(0,0,0,0.4)}
body.light .toast{background:#fff;color:#1e293b;border-color:#e2e8f0;box-shadow:0 8px 32px rgba(0,0,0,0.12)}
.toast.show{transform:translateX(-50%) translateY(0)}
.toast.toast-success{border-color:rgba(34,197,94,0.3);background:rgba(34,197,94,0.15)}
.toast.toast-error{border-color:rgba(239,68,68,0.3);background:rgba(239,68,68,0.15)}
.toast.toast-info{border-color:rgba(59,130,246,0.3);background:rgba(59,130,246,0.15)}
.theme-toggle{position:fixed;top:16px;right:16px;width:44px;height:44px;border-radius:50%;border:1px solid rgba(255,255,255,0.1);background:rgba(0,0,0,0.4);backdrop-filter:blur(8px);-webkit-backdrop-filter:blur(8px);cursor:pointer;z-index:100;display:flex;align-items:center;justify-content:center;font-size:20px;transition:all 0.3s;color:#fbbf24}
body.light .theme-toggle{background:rgba(255,255,255,0.8);border-color:rgba(0,0,0,0.1);color:#6366f1}
.theme-toggle:hover{transform:scale(1.1)}
.scroll-top{position:fixed;bottom:80px;right:16px;width:44px;height:44px;border-radius:50%;border:1px solid rgba(255,255,255,0.1);background:rgba(99,102,241,0.3);backdrop-filter:blur(8px);cursor:pointer;z-index:100;display:flex;align-items:center;justify-content:center;font-size:18px;color:#fff;transition:all 0.3s;opacity:0;pointer-events:none}
.scroll-top.visible{opacity:1;pointer-events:auto}
.scroll-top:hover{transform:scale(1.1);background:rgba(99,102,241,0.5)}
.verify-progress{text-align:center;padding:8px;color:#94a3b8;font-size:12px;font-weight:700;margin-bottom:16px;background:rgba(255,255,255,0.03);border-radius:8px;border:1px solid rgba(255,255,255,0.06);display:none}
.verify-progress.active{display:block}
.verify-bar{height:4px;background:rgba(255,255,255,0.06);border-radius:2px;margin-top:6px;overflow:hidden}
.verify-fill{height:100%;background:linear-gradient(90deg,#6366f1,#8b5cf6);border-radius:2px;transition:width 0.3s;width:0}
@keyframes shimmer{0%{background-position:200% 0}100%{background-position:-200% 0}}
@keyframes fadeUp{from{opacity:0;transform:translateY(16px)}to{opacity:1;transform:translateY(0)}}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:0.6}}
@keyframes popIn{0%{transform:scale(0.5)}50%{transform:scale(1.3)}100%{transform:scale(1)}}
@keyframes spinAnim{0%{transform:rotate(0)}100%{transform:rotate(360deg)}}
@media(max-width:640px){
body{padding:20px 10px 40px}
.games-grid,.skeleton-grid{grid-template-columns:1fr;gap:16px}
.stat-number{font-size:20px}.stat-card{padding:12px 16px;min-width:70px}
.gc-title{font-size:13px}.theme-toggle{top:10px;right:10px;width:38px;height:38px;font-size:17px}
}
</style>
</head>
<body>
<button class="theme-toggle" id="fg-theme" title="–¢–µ–º–∞">üåô</button>
<button class="scroll-top" id="fg-scroll-top" title="–ù–∞–≤–µ—Ä—Ö">‚Üë</button>
<div class="container">
<div class="header">
<h1 class="title">–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–µ –ò–≥—Ä—ã</h1>
<p class="subtitle">–†–∞–∑–¥–∞—á–∏ —Ä–∞–Ω–µ–µ –ø–ª–∞—Ç–Ω—ã—Ö –∏–≥—Ä ‚Äî –∑–∞–±–µ—Ä–∏ –∏ –æ—Å—Ç–∞–≤—å –Ω–∞–≤—Å–µ–≥–¥–∞</p>
<div class="meta-row">
<span class="update-badge">–û–±–Ω–æ–≤–ª–µ–Ω–æ: <span id="fg-ut"></span></span>
<span class="live-badge" id="fg-live" style="display:none">‚úÖ LIVE</span>
<span class="cache-badge" id="fg-cache" style="display:none">üì¶ –∫—ç—à</span>
<span class="fallback-badge" id="fg-fallback" style="display:none">üíæ –æ—Ñ–ª–∞–π–Ω</span>
<span class="loading-badge" id="fg-loading" style="display:none">‚è≥ –∑–∞–≥—Ä—É–∑–∫–∞...</span>
</div>
</div>
<div class="controls">
<input type="text" class="search-box" id="fg-sb" placeholder="üîç –ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é...">
<div class="filters" id="fg-fb"></div>
<div class="sort-row">
<button class="sort-btn on" data-sort="date">–ù–æ–≤—ã–µ</button>
<button class="sort-btn" data-sort="value">–ü–æ —Ü–µ–Ω–Ω–æ—Å—Ç–∏</button>
<button class="sort-btn" data-sort="az">–ê-–Ø</button>
<button class="sort-btn" data-sort="ending">–°–∫–æ—Ä–æ –∫–æ–Ω—á–∞—Ç—Å—è</button>
</div>
</div>
<div class="tabs">
<button class="tab on" data-t="all">–ê–∫—Ç–∏–≤–Ω—ã–µ (<span id="fg-ac">0</span>)</button>
<button class="tab" data-t="taken">–ó–∞–±—Ä–∞–Ω–æ (<span id="fg-tc">0</span>)</button>
<button class="tab" data-t="expired">–ò—Å—Ç—ë–∫—à–∏–µ (<span id="fg-ec">0</span>)</button>
</div>
<div class="tiny-row">
<label class="chk"><input type="checkbox" id="fg-hideTaken"> –°–∫—Ä—ã–≤–∞—Ç—å –∑–∞–±—Ä–∞–Ω–Ω—ã–µ</label>
</div>
<div class="toolbar">
<button class="tool-btn" id="fg-refresh">üîÑ –û–±–Ω–æ–≤–∏—Ç—å</button>
<button class="tool-btn" id="fg-export">üì§ –≠–∫—Å–ø–æ—Ä—Ç</button>
<button class="tool-btn" id="fg-import">üì• –ò–º–ø–æ—Ä—Ç</button>
<button class="tool-btn" id="fg-clear-taken">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å</button>
</div>
<div class="verify-progress" id="fg-vp">
<span id="fg-vp-text">üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Å—ã–ª–æ–∫...</span>
<div class="verify-bar"><div class="verify-fill" id="fg-vp-fill"></div></div>
</div>
<div class="stats" id="fg-st"></div>
<div id="fg-ct"></div>
<div class="src">
–î–∞–Ω–Ω—ã–µ: <a href="https://www.gamerpower.com" target="_blank" rel="noopener">GamerPower</a> ¬∑
<a href="https://store.epicgames.com/ru/free-games" target="_blank" rel="noopener">Epic Games</a> ¬∑
<a href="https://www.gog.com" target="_blank" rel="noopener">GOG</a>
</div>
</div>
<div class="toast" id="fg-toast"></div>
<input type="file" id="fg-file-input" accept=".json" style="display:none">

<script>
(function(){
'use strict';

var FALLBACK=[
{id:'fb-nwtd',title:'Nobody Wants to Die',desc:'–ù—É–∞—Ä–Ω—ã–π –¥–µ—Ç–µ–∫—Ç–∏–≤ –≤ –ù—å—é-–ô–æ—Ä–∫–µ 2329 –≥–æ–¥–∞.',img:'https://www.gamerpower.com/offers/1/67a7e9e5e0338.jpg',url:'https://store.epicgames.com/ru/p/nobody-wants-to-die-a09dd1',end:'2026-02-20T16:00:00.000Z',store:'epic',worth:29.99,hot:true,linkStatus:'ok'},
{id:'fb-dd2',title:'The Darkside Detective: A Fumble in the Dark',desc:'–ü–∏–∫—Å–µ–ª—å–Ω—ã–π point-and-click –¥–µ—Ç–µ–∫—Ç–∏–≤.',img:'https://www.gamerpower.com/offers/1/67a7ea3a7b80b.jpg',url:'https://store.epicgames.com/ru/p/the-darkside-detective-a-fumble-in-the-dark-4967f3',end:'2026-02-20T16:00:00.000Z',store:'epic',worth:17.99,hot:true,linkStatus:'ok'},
{id:'fb-aitd',title:'Alone in the Dark: The Trilogy',desc:'–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è —Ç—Ä–∏–ª–æ–≥–∏—è survival-—Ö–æ—Ä—Ä–æ—Ä–æ–≤.',img:'https://www.gamerpower.com/offers/1/679a1a6acbf56.jpg',url:'https://www.gog.com/en/game/alone_in_the_dark_the_trilogy_123',end:null,store:'gog',worth:5.99,hot:false,linkStatus:'ok'},
{id:'fb-encased',title:'Encased: A Sci-Fi Post-Apocalyptic RPG',desc:'–ò–∑–æ–º–µ—Ç—Ä–∏—á–µ—Å–∫–∞—è sci-fi RPG –≤ –¥—É—Ö–µ Fallout.',img:'https://www.gamerpower.com/offers/1/6784e75946a76.jpg',url:'https://store.steampowered.com/app/921800/',end:null,store:'steam',worth:29.99,hot:true,linkStatus:'ok'}
];

var TITLE_BLACKLIST=['demo','trial','beta','alpha','playtest','starter pack','starter edition','free to play','free-to-play','f2p','dlc','expansion','season pass','battle pass','soundtrack','artbook','art book','wallpaper','bonus content','cosmetic','skin pack','in-game','virtual currency','coin','gems','loot box','loot crate','mystery box','coupon','discount','voucher','% off'];
var F2P_BLACKLIST=['fortnite','apex legends','warframe','dota 2','dota2','league of legends','valorant','genshin impact','counter-strike','cs2','csgo','cs:go','team fortress 2','tf2','path of exile','poe','destiny 2','lost ark','world of tanks','war thunder','world of warships','hearthstone','rocket league','fall guys','multiversus','the finals','xdefiant','overwatch 2','palworld','honkai','star rail','zenless zone zero'];

var games=[];
var tab='all',filt='all',sort='date';
var taken={};
var isLoading=true;
var theme='dark';
// Link verification cache: { url: 'ok'|'dead'|'unknown' }
var linkCache={};

function $(id){return document.getElementById(id)}
function esc(s){var d=document.createElement('div');d.textContent=String(s||'');return d.innerHTML}

/* ‚îÄ‚îÄ Storage ‚îÄ‚îÄ */
function setCookie(n,v,d){var e=new Date();e.setTime(e.getTime()+(d||365)*864e5);document.cookie=n+'='+encodeURIComponent(v)+';expires='+e.toUTCString()+';path=/;SameSite=Lax'}
function getCookie(n){var p=n+'=',ca=document.cookie.split(';');for(var i=0;i<ca.length;i++){var c=ca[i].trim();if(c.indexOf(p)===0)return decodeURIComponent(c.substring(p.length))}return null}

function loadTaken(){
try{var r=localStorage.getItem('fgtaken2');if(r){taken=JSON.parse(r);return}}catch(e){}
try{var ck=getCookie('fgtaken2');if(ck){taken=JSON.parse(ck);return}}catch(e){}
try{var old=JSON.parse(localStorage.getItem('fgtaken')||'[]');if(Array.isArray(old)&&old.length){taken={};old.forEach(function(id){taken[id]={ts:Date.now(),worth:0}});saveTaken();return}}catch(e){}
taken={};
}
function saveTaken(){
var j=JSON.stringify(taken);
try{localStorage.setItem('fgtaken2',j)}catch(e){}
try{if(j.length<3500)setCookie('fgtaken2',j,365)}catch(e){}
}
function loadLinkCache(){
try{var r=JSON.parse(localStorage.getItem('fglinks2')||'{}');
// Expire after 6 hours
if(r._ts&&Date.now()-r._ts<6*3600000){linkCache=r;delete linkCache._ts}else linkCache={}}catch(e){linkCache={}}
}
function saveLinkCache(){
try{var c=Object.assign({},linkCache);c._ts=Date.now();localStorage.setItem('fglinks2',JSON.stringify(c))}catch(e){}
}
function loadPrefs(){
try{var p=JSON.parse(localStorage.getItem('fgprefs3')||'{}');if(p.sort)sort=p.sort;if(p.hideTaken)$('fg-hideTaken').checked=true;if(p.theme){theme=p.theme;applyTheme()}}catch(e){}
}
function savePrefs(){
try{localStorage.setItem('fgprefs3',JSON.stringify({sort:sort,hideTaken:$('fg-hideTaken').checked,theme:theme}))}catch(e){}
}

/* ‚îÄ‚îÄ Theme ‚îÄ‚îÄ */
function applyTheme(){document.body.classList.toggle('light',theme==='light');$('fg-theme').textContent=theme==='dark'?'üåô':'‚òÄÔ∏è'}
function toggleTheme(){theme=theme==='dark'?'light':'dark';applyTheme();savePrefs()}

/* ‚îÄ‚îÄ Toast ‚îÄ‚îÄ */
var toastTimer=null;
function showToast(m,t){var el=$('fg-toast');el.textContent=m;el.className='toast show'+(t?' toast-'+t:'');clearTimeout(toastTimer);toastTimer=setTimeout(function(){el.classList.remove('show')},3000)}

/* ‚îÄ‚îÄ Fetch ‚îÄ‚îÄ */
function fetchTimeout(url,ms){
return new Promise(function(ok,no){
var c=new AbortController();var t=setTimeout(function(){c.abort()},ms||10000);
fetch(url,{signal:c.signal}).then(function(r){clearTimeout(t);if(!r.ok)throw new Error('HTTP '+r.status);return r.json()}).then(ok).catch(function(e){clearTimeout(t);no(e)});
});
}
function smartFetch(url,ms){
return fetchTimeout(url,ms||10000).catch(function(){
return fetchTimeout('https://api.allorigins.win/raw?url='+encodeURIComponent(url),12000);
}).catch(function(){
return fetchTimeout('https://corsproxy.io/?'+encodeURIComponent(url),12000);
});
}

/* ‚îÄ‚îÄ Link Verification ‚îÄ‚îÄ */
function verifyLink(url){
if(!url||url==='#')return Promise.resolve('dead');
// Already cached
if(linkCache[url])return Promise.resolve(linkCache[url]);
// Known good patterns
if(isKnownGoodURL(url)){linkCache[url]='ok';return Promise.resolve('ok')}
// Try HEAD via proxy
return fetch('https://api.allorigins.win/raw?url='+encodeURIComponent(url),{method:'HEAD',signal:AbortSignal.timeout?AbortSignal.timeout(5000):undefined})
.then(function(r){
var s=r.ok?'ok':'dead';
linkCache[url]=s;return s;
}).catch(function(){
// Try GET with allorigins info endpoint
return fetch('https://api.allorigins.win/get?url='+encodeURIComponent(url),{signal:AbortSignal.timeout?AbortSignal.timeout(6000):undefined})
.then(function(r){return r.json()})
.then(function(d){
var s=(d.status&&d.status.http_code>=200&&d.status.http_code<400)?'ok':'dead';
linkCache[url]=s;return s;
}).catch(function(){
linkCache[url]='unknown';return'unknown';
});
});
}

function isKnownGoodURL(url){
// URLs from official API are trusted
if(url.indexOf('store.epicgames.com')>=0&&url.indexOf('/p/')>=0)return true;
if(url.indexOf('store.steampowered.com/app/')>=0)return true;
if(url.indexOf('gog.com')>=0&&url.indexOf('/game/')>=0)return true;
return false;
}

function verifyAllLinks(gamesList){
var toVerify=gamesList.filter(function(g){
return g.url&&g.url!=='#'&&!linkCache[g.url]&&!isKnownGoodURL(g.url);
});
if(!toVerify.length){saveLinkCache();return Promise.resolve()}
var vp=$('fg-vp'),vpText=$('fg-vp-text'),vpFill=$('fg-vp-fill');
vp.classList.add('active');
var done=0,total=toVerify.length;
vpText.textContent='üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Å—ã–ª–æ–∫: 0/'+total;
vpFill.style.width='0%';

// Verify sequentially (not to overload proxy)
var chain=Promise.resolve();
toVerify.forEach(function(g){
chain=chain.then(function(){
return verifyLink(g.url).then(function(status){
g.linkStatus=status;
done++;
vpText.textContent='üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Å—ã–ª–æ–∫: '+done+'/'+total;
vpFill.style.width=Math.round(done/total*100)+'%';
});
});
});
return chain.then(function(){
saveLinkCache();
vp.classList.remove('active');
// Update games with verification results
gamesList.forEach(function(g){
if(linkCache[g.url])g.linkStatus=linkCache[g.url];
});
render();
var deadCount=gamesList.filter(function(g){return g.linkStatus==='dead'}).length;
if(deadCount>0)showToast('‚ö†Ô∏è '+deadCount+' —Å—Å—ã–ª–æ–∫ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã ‚Äî —Å–∫—Ä—ã—Ç—ã','info');
});
}

/* ‚îÄ‚îÄ Cache ‚îÄ‚îÄ */
var CK='fgcache9',CTL=30*60*1000;
function cacheGet(){try{var r=JSON.parse(localStorage.getItem(CK));if(r&&Date.now()-r.ts<CTL)return r.data;return null}catch(e){return null}}
function cacheSet(d){try{localStorage.setItem(CK,JSON.stringify({ts:Date.now(),data:d}))}catch(e){}}

/* ‚îÄ‚îÄ Verify game is actual giveaway ‚îÄ‚îÄ */
function isActuallyFree(g){
var t=(g.title||'').toLowerCase();
for(var i=0;i<TITLE_BLACKLIST.length;i++){if(t.indexOf(TITLE_BLACKLIST[i])>=0)return false}
for(var j=0;j<F2P_BLACKLIST.length;j++){if(t.indexOf(F2P_BLACKLIST[j])>=0)return false}
if(g._rawType){var rt=g._rawType.toLowerCase();if(rt.indexOf('dlc')>=0||rt.indexOf('loot')>=0||rt.indexOf('early')>=0)return false}
if(g._rawStatus&&g._rawStatus!=='Active')return false;
if(g.worth===0&&!g.end&&g.store==='other')return false;
return true;
}

/* ‚îÄ‚îÄ Normalize ‚îÄ‚îÄ */
function norm(g){
return{id:g.id||'',title:g.title||'',desc:g.desc||'',img:g.img||'',url:g.url||'#',end:g.end||null,store:g.store||'other',worth:g.worth||0,hot:!!g.hot,ts:g.ts||Date.now(),verified:!!g.verified,linkStatus:g.linkStatus||'unknown',_rawType:g._rawType||'',_rawStatus:g._rawStatus||'',_epicSlug:g._epicSlug||''};
}

function normalizeTitle(t){
return(t||'').toLowerCase().replace(/‚Ñ¢|¬Æ|¬©|Ôºö/g,'')
.replace(/\s*[\-‚Äì‚Äî:]\s*(standard|deluxe|ultimate|gold|goty|game of the year|edition|complete|definitive|enhanced|remastered|hd|collection|bundle|pack|the trilogy|trilogy|1\+2\+3|123)\b/gi,'')
.replace(/\(.*?(epic|steam|gog|giveaway|pc|drm|free).*?\)/gi,'')
.replace(/\s+giveaway$/i,'')
.replace(/[^a-z–∞-—è—ë0-9]/g,'');
}

/* ‚îÄ‚îÄ Epic slug extraction (FIXED) ‚îÄ‚îÄ */
function getEpicSlug(g){
try{var m=g.catalogNs&&g.catalogNs.mappings;if(m&&m.length){for(var i=0;i<m.length;i++){if(m[i].pageSlug&&m[i].pageSlug!=='[]')return{slug:m[i].pageSlug,type:'mapping'}}}}catch(e){}
try{var om=g.offerMappings;if(om&&om.length){for(var j=0;j<om.length;j++){if(om[j].pageSlug)return{slug:om[j].pageSlug,type:'offer'}}}}catch(e){}
if(g.productSlug&&g.productSlug!=='[]'&&g.productSlug!=='null'&&g.productSlug.length>1)return{slug:g.productSlug,type:'product'};
if(g.urlSlug&&g.urlSlug.length>1)return{slug:g.urlSlug,type:'url'};
return{slug:'',type:'none'};
}

function buildEpicURL(slugInfo,categories){
if(!slugInfo.slug)return'https://store.epicgames.com/ru/free-games';
var isBundle=false;
if(categories){for(var k=0;k<categories.length;k++){if(categories[k].path==='bundles'){isBundle=true;break}}}
var base=isBundle?'https://store.epicgames.com/ru/bundles/':'https://store.epicgames.com/ru/p/';
return base+slugInfo.slug;
}

/* ‚îÄ‚îÄ API: GamerPower ‚îÄ‚îÄ */
function mapStore(p){
p=(p||'').toLowerCase();
if(p.indexOf('epic')>=0)return'epic';if(p.indexOf('steam')>=0)return'steam';
if(p.indexOf('gog')>=0)return'gog';if(p.indexOf('itch')>=0)return'itchio';return'other';
}

function extractDirectURL(rawURL,store){
// Try to extract direct store URL from GamerPower redirect
// GamerPower URLs go through their tracker, we can't get the final URL
// But we can try to construct it ourselves for known stores
if(!rawURL||rawURL==='#')return rawURL;
if(rawURL.indexOf('gamerpower.com')>=0){
// This is a redirect URL ‚Äî mark as needing verification
return rawURL;
}
// Already a direct URL
return rawURL;
}

function fetchGP(){
return smartFetch('https://www.gamerpower.com/api/giveaways?type=game&sort-by=value',10000).then(function(d){
if(!Array.isArray(d))return[];
return d.filter(function(g){
var p=(g.platforms||'').toLowerCase();
return p.indexOf('pc')>=0||p.indexOf('steam')>=0||p.indexOf('epic')>=0||p.indexOf('gog')>=0||p.indexOf('itch')>=0||p.indexOf('drm')>=0;
}).map(function(g){
var w=0;try{w=parseFloat(String(g.worth||'0').replace(/[^0-9.]/g,''))||0}catch(e){}
var store=mapStore(g.platforms);
var rawURL=g.open_giveaway_url||g.gamerpower_url||'#';
var url=extractDirectURL(rawURL,store);
var isGPRedirect=url.indexOf('gamerpower.com')>=0;

return norm({
id:'gp-'+g.id,title:g.title,desc:g.description||g.short_description||'',
img:g.thumbnail||g.image||'',url:url,
end:(g.end_date&&g.end_date!=='N/A')?g.end_date:null,
store:store,worth:w,hot:w>15,ts:Date.now(),verified:!isGPRedirect,
linkStatus:isGPRedirect?'unknown':(isKnownGoodURL(url)?'ok':'unknown'),
_rawType:g.type||'',_rawStatus:g.status||''
});
}).filter(function(g){return g.title&&isActuallyFree(g)});
});
}

/* ‚îÄ‚îÄ API: Epic (FIXED) ‚îÄ‚îÄ */
function fetchEpic(){
return smartFetch('https://store-site-backend-static-ipv4.ak.epicgames.com/freeGamesPromotions?locale=en-US&country=US&allowCountries=US',10000).then(function(data){
var el=(data&&data.data&&data.data.Catalog&&data.data.Catalog.searchStore&&data.data.Catalog.searchStore.elements)||[];
var out=[];
for(var i=0;i<el.length;i++){
var g=el[i];if(!g.promotions)continue;
var off=g.promotions.promotionalOffers||[];
if(!off.length||!off[0].promotionalOffers||!off[0].promotionalOffers.length)continue;
var o=off[0].promotionalOffers[0];
var dp=0;try{dp=o.discountSetting.discountPercentage}catch(e){}
if(dp!==0)continue;
var cp=-1;try{cp=g.price.totalPrice.discountPrice}catch(e){}
if(cp!==0)continue;
var img='';var ki=g.keyImages||[];
var pref=['OfferImageWide','DieselStoreFrontWide','OfferImageTall','DieselStoreFrontTall','Thumbnail','DieselGameBoxWide'];
for(var p=0;p<pref.length;p++){for(var j=0;j<ki.length;j++){if(ki[j].type===pref[p]){img=ki[j].url;break}}if(img)break}
if(!img&&ki.length)img=ki[0].url;

var slugInfo=getEpicSlug(g);
var url=buildEpicURL(slugInfo,g.categories);
var w=0;try{var pr=g.price&&g.price.totalPrice;if(pr&&pr.originalPrice)w=pr.originalPrice/100}catch(e){}

var game=norm({
id:'ep-'+g.id,title:g.title||'',desc:g.description||'–ë–µ—Å–ø–ª–∞—Ç–Ω–æ –≤ Epic Games Store',
img:img,url:url,end:o.endDate,store:'epic',worth:w,hot:true,ts:Date.now(),
verified:slugInfo.type==='mapping'||slugInfo.type==='offer',
linkStatus:(slugInfo.type==='mapping'||slugInfo.type==='offer')?'ok':(slugInfo.slug?'unknown':'dead'),
_rawType:'game',_rawStatus:'Active',_epicSlug:slugInfo.slug
});
if(game.title&&isActuallyFree(game)&&game.linkStatus!=='dead')out.push(game);
}
return out;
});
}

/* ‚îÄ‚îÄ Merge (improved) ‚îÄ‚îÄ */
function mergeGames(){
var args=[].slice.call(arguments);
var result=[];
var seen={}; // normalizedTitle -> { game, priority }

// Priority: epic API (1) > direct links (2) > gamerpower redirects (3)
function getPriority(g){
if(g.id.indexOf('ep-')===0)return 1;
if(g.linkStatus==='ok'&&g.verified)return 2;
if(g.linkStatus==='ok')return 3;
if(g.linkStatus==='unknown')return 4;
return 5;
}

args.forEach(function(arr){
if(!Array.isArray(arr))return;
arr.forEach(function(g){
var nTitle=normalizeTitle(g.title);
var key=g.store+':'+nTitle;
var priority=getPriority(g);

if(seen[key]){
// Keep higher priority (lower number)
if(priority<seen[key].priority){
seen[key]={game:g,priority:priority};
}
}else{
seen[key]={game:g,priority:priority};
}
});
});

Object.keys(seen).forEach(function(k){result.push(seen[k].game)});
return result;
}

/* ‚îÄ‚îÄ Taken ‚îÄ‚îÄ */
function isTaken(id){return!!taken[id]}
function toggleTaken(id){
var btn=document.querySelector('.take-btn[data-id="'+id+'"]');
if(taken[id]){delete taken[id];showToast('–£–±—Ä–∞–Ω–æ –∏–∑ –∑–∞–±—Ä–∞–Ω–Ω—ã—Ö','info')}
else{var g=games.find(function(x){return x.id===id});taken[id]={ts:Date.now(),worth:g?g.worth:0};showToast('‚úì –ó–∞–±—Ä–∞–Ω–æ!','success')}
if(btn){btn.classList.add('pop');setTimeout(function(){btn.classList.remove('pop')},400)}
saveTaken();updateCounts();render();
}
window._fgT=toggleTaken;

function updateCounts(){
$('fg-tc').textContent=Object.keys(taken).length;
var vis=getVisibleGames();
$('fg-ac').textContent=vis.active.length;
$('fg-ec').textContent=vis.expired.length;
}
function getVisibleGames(){
var active=games.filter(function(g){return!isExpired(g)&&g.linkStatus!=='dead'});
var expired=games.filter(function(g){return isExpired(g)});
return{active:active,expired:expired};
}
function getTakenSavings(){
var t=0;Object.keys(taken).forEach(function(id){
var w=taken[id].worth||0;if(w>0){t+=w;return}
var g=games.find(function(x){return x.id===id});if(g&&g.worth>0)t+=g.worth;
});return t;
}

/* ‚îÄ‚îÄ Export/Import ‚îÄ‚îÄ */
function exportTaken(){
var d={version:2,exported:new Date().toISOString(),taken:taken,count:Object.keys(taken).length};
var b=new Blob([JSON.stringify(d,null,2)],{type:'application/json'});
var u=URL.createObjectURL(b);var a=document.createElement('a');a.href=u;
a.download='free-games-'+new Date().toISOString().slice(0,10)+'.json';a.click();URL.revokeObjectURL(u);
showToast('üì§ –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ '+Object.keys(taken).length,'success');
}
function importTaken(file){
var r=new FileReader();r.onload=function(e){
try{var d=JSON.parse(e.target.result);
if(d.taken&&typeof d.taken==='object'){var a=0;Object.keys(d.taken).forEach(function(id){if(!taken[id]){taken[id]=d.taken[id];a++}});saveTaken();updateCounts();render();showToast('üì• +'+a+' –∏–≥—Ä','success')}
else if(Array.isArray(d)){d.forEach(function(id){if(!taken[id])taken[id]={ts:Date.now(),worth:0}});saveTaken();updateCounts();render();showToast('üì• –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ','success')}
else showToast('‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç','error');
}catch(err){showToast('‚ùå –û—à–∏–±–∫–∞','error')}};
r.readAsText(file);
}

/* ‚îÄ‚îÄ Time ‚îÄ‚îÄ */
function countdown(end){
if(!end)return null;
try{var d=new Date(end).getTime()-Date.now();
if(d<0)return{expired:true,text:'–†–∞–∑–¥–∞—á–∞ –∑–∞–∫–æ–Ω—á–∏–ª–∞—Å—å',ms:d};
var days=Math.floor(d/864e5),hrs=Math.floor((d%864e5)/36e5),mins=Math.floor((d%36e5)/6e4),secs=Math.floor((d%6e4)/1e3);
var text=days>0?days+'–¥ '+hrs+'—á '+mins+'–º '+secs+'—Å':hrs+'—á '+mins+'–º '+secs+'—Å';
return{expired:false,text:text,ms:d,ending:d<864e5};
}catch(e){return null}
}
function isExpired(g){if(!g.end)return false;return new Date(g.end).getTime()<Date.now()}
function isEndingSoon(g){if(!g.end)return false;var d=new Date(g.end).getTime()-Date.now();return d>0&&d<864e5}
function isNew(g){return g.ts&&(Date.now()-g.ts<48*36e5)}

/* ‚îÄ‚îÄ Sort ‚îÄ‚îÄ */
function sortGames(arr){
var c=arr.slice();
if(sort==='value')c.sort(function(a,b){return(b.worth||0)-(a.worth||0)});
else if(sort==='az')c.sort(function(a,b){return a.title.localeCompare(b.title)});
else if(sort==='ending')c.sort(function(a,b){var ae=a.end?new Date(a.end).getTime():Infinity;var be=b.end?new Date(b.end).getTime():Infinity;return ae-be});
else c.sort(function(a,b){if(a.hot!==b.hot)return a.hot?-1:1;return(b.worth||0)-(a.worth||0)});
return c;
}

function imgError(el){el.style.display='none';var ph=el.nextElementSibling;if(ph)ph.style.display='flex'}
window._fgI=imgError;

function skeletonHTML(){
var h='<div class="skeleton-grid">';for(var i=0;i<6;i++)h+='<div class="skeleton-card"><div class="skeleton-img"></div><div class="skeleton-body"><div class="skeleton-line w80"></div><div class="skeleton-line w60"></div><div class="skeleton-line w40"></div></div></div>';
return h+'</div>';
}

/* ‚îÄ‚îÄ Card ‚îÄ‚îÄ */
function cardHTML(g,i){
var tkn=isTaken(g.id),cd=countdown(g.end),expired=isExpired(g),ending=isEndingSoon(g);
var isDead=g.linkStatus==='dead',isUnknown=g.linkStatus==='unknown'&&!g.verified;
var gr='linear-gradient(135deg,#1e1b4b,#312e81)';
if(g.store==='epic')gr='linear-gradient(135deg,#1a1a2e,#16213e)';
if(g.store==='gog')gr='linear-gradient(135deg,#1a0a2e,#2d1b69)';
if(g.store==='steam')gr='linear-gradient(135deg,#1b2838,#2a475e)';
if(g.store==='itchio')gr='linear-gradient(135deg,#2e1a1a,#691b1b)';

var imgH='';
if(g.img){imgH='<img src="'+esc(g.img)+'" class="gi" alt="'+esc(g.title)+'" loading="lazy" decoding="async" referrerpolicy="no-referrer" onerror="_fgI(this)"><div class="gi-ph" style="display:none;background:'+gr+'">'+esc(g.title)+'</div>'}
else{imgH='<div class="gi-ph" style="background:'+gr+'">'+esc(g.title)+'</div>'}

var badges='';
if(g.verified&&g.linkStatus==='ok')badges+='<span class="badge b-verified">‚úì OK</span>';
else if(isUnknown)badges+='<span class="badge b-unverified">‚ùì</span>';
badges+='<span class="badge b-'+(g.store||'other')+'">'+(g.store||'other').toUpperCase()+'</span>';
if(g.worth>0)badges+='<span class="badge b-val">$'+(g.worth||0).toFixed(0)+'</span>';
if(ending&&!expired)badges+='<span class="badge b-ending">‚ö° –°–ö–û–†–û</span>';
else if(isNew(g))badges+='<span class="badge b-new">üÜï NEW</span>';
if(g.hot&&!expired)badges+='<span class="badge b-hot">üî• HOT</span>';
if(expired)badges+='<span class="badge b-expired">‚è∞ –ò–°–¢–ï–ö–õ–û</span>';
if(tkn)badges+='<span class="badge b-taken">‚úì –ó–ê–ë–†–ê–ù–û</span>';

var cdHTML='';
if(cd){
if(cd.expired)cdHTML='<div class="cd cd-expired"><div class="cd-t">‚è∞ –°—Ç–∞—Ç—É—Å:</div><div class="cd-v">'+cd.text+'</div></div>';
else{var cc='cd'+(cd.ending?' cd-ending':'');cdHTML='<div class="'+cc+'"><div class="cd-t">'+(cd.ending?'‚ö° –°–∫–æ—Ä–æ!':'‚è∞ –û—Å—Ç–∞–ª–æ—Å—å:')+'</div><div class="cd-v" data-end="'+g.end+'">'+cd.text+'</div></div>'}
}

var warnHTML='';
if(isDead)warnHTML='<div class="link-dead">üö´ –°—Ç—Ä–∞–Ω–∏—Ü–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞</div>';
else if(isUnknown)warnHTML='<div class="link-warning">‚ö†Ô∏è –°—Å—ã–ª–∫–∞ –Ω–µ –ø—Ä–æ–≤–µ—Ä–µ–Ω–∞ ‚Äî –º–æ–∂–µ—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞—Ç—å</div>';

var cardCls='gc'+(expired?' expired-card':'')+(ending&&!expired?' ending-soon':'')+(isUnknown?' unverified-link':'');
var linkCls='gc-link'+(expired||isDead?' disabled':'')+(isUnknown?' warn-link':'');
var linkText=expired?'–ó–∞–∫–æ–Ω—á–∏–ª–∞—Å—å':(isDead?'–ù–µ–¥–æ—Å—Ç—É–ø–Ω–æ':'–ó–∞–±—Ä–∞—Ç—å ‚Üí');

return'<div class="'+cardCls+'" style="animation-delay:'+(i*0.04)+'s">'
+'<button class="take-btn '+(tkn?'on':'')+'" data-id="'+g.id+'" title="'+(tkn?'–£–±—Ä–∞—Ç—å':'–ó–∞–±—Ä–∞—Ç—å')+'" onclick="_fgT(\''+g.id+'\')">'+(tkn?'‚úì':'Ôºã')+'</button>'
+imgH+'<div class="gc-body">'
+'<div class="gc-head"><h3 class="gc-title">'+esc(g.title)+'</h3><div class="gc-badges">'+badges+'</div></div>'
+'<p class="gc-desc">'+esc(g.desc)+'</p>'+cdHTML+warnHTML
+'<div class="gc-foot"><div class="p-free">–ë–µ—Å–ø–ª–∞—Ç–Ω–æ</div>'
+'<a href="'+esc(g.url||'#')+'" target="_blank" rel="noopener" class="'+linkCls+'">'+linkText+'</a>'
+'</div></div></div>';
}

/* ‚îÄ‚îÄ Render ‚îÄ‚îÄ */
function render(){
var el=$('fg-ct'),q=($('fg-sb').value||'').toLowerCase();
var vis=getVisibleGames();

var list;
if(tab==='taken')list=games.filter(function(g){return isTaken(g.id)});
else if(tab==='expired')list=vis.expired;
else{
list=vis.active.slice();
if($('fg-hideTaken').checked)list=list.filter(function(g){return!isTaken(g.id)});
}

if(q)list=list.filter(function(g){return g.title.toLowerCase().indexOf(q)>=0||g.desc.toLowerCase().indexOf(q)>=0});
if(filt!=='all')list=list.filter(function(g){return g.store===filt});
list=sortGames(list);

var srcList=(tab==='expired')?vis.expired:vis.active;
var stores=[];srcList.forEach(function(g){if(stores.indexOf(g.store)<0)stores.push(g.store)});
var fh='<button class="fbtn '+(filt==='all'?'on':'')+'" data-filt="all">–í—Å–µ</button>';
stores.forEach(function(s){fh+='<button class="fbtn '+(filt===s?'on':'')+'" data-filt="'+s+'">'+s.toUpperCase()+'</button>'});
$('fg-fb').innerHTML=fh;

document.querySelectorAll('.sort-btn').forEach(function(b){b.classList.toggle('on',b.getAttribute('data-sort')===sort)});

var sc={},tv=0;
list.forEach(function(g){sc[g.store]=(sc[g.store]||0)+1;tv+=(g.worth||0)});
var sh='';Object.keys(sc).forEach(function(k){sh+='<div class="stat-card"><div class="stat-number">'+sc[k]+'</div><div class="stat-label">'+k.toUpperCase()+'</div></div>'});
sh+='<div class="stat-card"><div class="stat-number">'+list.length+'</div><div class="stat-label">–í—Å–µ–≥–æ</div></div>';
if(tv>0)sh+='<div class="stat-card value-card"><div class="stat-number green">$'+tv.toFixed(0)+'</div><div class="stat-label green">–¶–µ–Ω–Ω–æ—Å—Ç—å</div></div>';
var sav=getTakenSavings();
if(sav>0)sh+='<div class="stat-card savings-card"><div class="stat-number blue">$'+sav.toFixed(0)+'</div><div class="stat-label blue">üí∞ –°—ç–∫–æ–Ω–æ–º–ª–µ–Ω–æ</div></div>';
$('fg-st').innerHTML=sh;

if(list.length)el.innerHTML='<div class="games-grid">'+list.map(cardHTML).join('')+'</div>';
else{
var m='üîç –ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ';
if(tab==='taken')m='üìã –û—Ç–º–µ—Ç—å—Ç–µ –∏–≥—Ä—ã –∫–Ω–æ–ø–∫–æ–π Ôºã';
if(tab==='expired')m='üì¶ –ù–µ—Ç –∏—Å—Ç—ë–∫—à–∏—Ö';
el.innerHTML='<div class="empty">'+m+'</div>';
}
}

/* ‚îÄ‚îÄ Live timers ‚îÄ‚îÄ */
function updateTimers(){
document.querySelectorAll('.cd-v[data-end]').forEach(function(el){
var cd=countdown(el.getAttribute('data-end'));
if(cd&&!cd.expired)el.textContent=cd.text;
else if(cd&&cd.expired){el.textContent='–ó–∞–∫–æ–Ω—á–∏–ª–∞—Å—å';var p=el.closest('.cd');if(p){p.classList.add('cd-expired');p.classList.remove('cd-ending')}}
});
}

/* ‚îÄ‚îÄ Badges ‚îÄ‚îÄ */
function showBadge(s){
$('fg-live').style.display=s==='live'?'inline-block':'none';
$('fg-cache').style.display=s==='cache'?'inline-block':'none';
$('fg-fallback').style.display=s==='fallback'?'inline-block':'none';
$('fg-loading').style.display=s==='loading'?'inline-block':'none';
}

/* ‚îÄ‚îÄ Main fetch ‚îÄ‚îÄ */
function fetchAllData(force){
isLoading=true;showBadge('loading');
if(!force){var cached=cacheGet();if(cached&&cached.length){games=cached.map(norm);applyLinkCache();showBadge('cache');updateCounts();render()}}

Promise.all([
fetchGP().catch(function(e){console.warn('GP:',e);return[]}),
fetchEpic().catch(function(e){console.warn('Epic:',e);return[]})
]).then(function(res){
var gp=res[0]||[],epic=res[1]||[],fb=FALLBACK.map(norm).filter(isActuallyFree);

if(gp.length||epic.length){
games=mergeGames(epic,gp,fb);
applyLinkCache();
showBadge('live');cacheSet(games);
showToast('‚úÖ '+games.length+' –∏–≥—Ä –∑–∞–≥—Ä—É–∂–µ–Ω–æ','success');
// Verify unknown links in background
verifyAllLinks(games);
}else if(!games.length){
games=fb;showBadge('fallback');
showToast('‚ö†Ô∏è API –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ','error');
}

isLoading=false;
$('fg-ut').textContent=new Date().toLocaleString('ru-RU');
updateCounts();render();
});
}

function applyLinkCache(){
games.forEach(function(g){
if(linkCache[g.url]){g.linkStatus=linkCache[g.url]}
else if(isKnownGoodURL(g.url)){g.linkStatus='ok';linkCache[g.url]='ok'}
});
}

/* ‚îÄ‚îÄ Scroll ‚îÄ‚îÄ */
window.addEventListener('scroll',function(){$('fg-scroll-top').classList.toggle('visible',window.scrollY>400)});
$('fg-scroll-top').addEventListener('click',function(){window.scrollTo({top:0,behavior:'smooth'})});

/* ‚îÄ‚îÄ Events ‚îÄ‚îÄ */
document.addEventListener('click',function(e){
var f=e.target.closest('.fbtn[data-filt]');if(f){filt=f.getAttribute('data-filt');render();return}
var s=e.target.closest('.sort-btn[data-sort]');if(s){sort=s.getAttribute('data-sort');savePrefs();render();return}
var t=e.target.closest('.tab[data-t]');if(t){tab=t.getAttribute('data-t');filt='all';document.querySelectorAll('.tab').forEach(function(b){b.classList.toggle('on',b.getAttribute('data-t')===tab)});render();$('fg-st').scrollIntoView({behavior:'smooth',block:'start'})}
});

$('fg-sb').addEventListener('input',render);
$('fg-hideTaken').addEventListener('change',function(){savePrefs();render()});
$('fg-theme').addEventListener('click',toggleTheme);

$('fg-refresh').addEventListener('click',function(){
var b=$('fg-refresh');if(b.classList.contains('refreshing'))return;
b.classList.add('refreshing');b.innerHTML='<span class="spin">üîÑ</span> ...';
// Clear link cache on manual refresh
linkCache={};saveLinkCache();
fetchAllData(true);
setTimeout(function(){b.classList.remove('refreshing');b.innerHTML='üîÑ –û–±–Ω–æ–≤–∏—Ç—å'},3000);
});

$('fg-export').addEventListener('click',exportTaken);
$('fg-import').addEventListener('click',function(){$('fg-file-input').click()});
$('fg-file-input').addEventListener('change',function(e){if(e.target.files&&e.target.files[0]){importTaken(e.target.files[0]);e.target.value=''}});
$('fg-clear-taken').addEventListener('click',function(){
if(!Object.keys(taken).length){showToast('–£–∂–µ –ø—É—Å—Ç–æ','info');return}
if(confirm('–û—á–∏—Å—Ç–∏—Ç—å? ('+Object.keys(taken).length+')')){taken={};saveTaken();updateCounts();render();showToast('üóëÔ∏è –û—á–∏—â–µ–Ω–æ','info')}
});

document.addEventListener('keydown',function(e){
if(e.key==='/'&&document.activeElement!==$('fg-sb')){e.preventDefault();$('fg-sb').focus()}
if(e.key==='Escape'){$('fg-sb').value='';$('fg-sb').blur();render()}
});

/* ‚îÄ‚îÄ Init ‚îÄ‚îÄ */
loadTaken();loadLinkCache();loadPrefs();applyTheme();
$('fg-ut').textContent=new Date().toLocaleString('ru-RU');
$('fg-ct').innerHTML=skeletonHTML();
games=FALLBACK.map(norm);showBadge('fallback');updateCounts();render();
fetchAllData(false);
setInterval(updateTimers,1000);
setInterval(function(){updateCounts();render()},3e5);
})();
</script>
</body>
</html>
